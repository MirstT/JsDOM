<!--
 * @Description  : 
 * @version      : 
 * @Author       : Mirst
 * @Date         : 2021-12-10 18:28:19
 * @LastEditors  : Mirst
 * @LastEditTime : 2021-12-14 11:29:44
-->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@2.0.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-vis"></script>
    <title>code sample for script tag setup</title>
</head>

<body>
    <script>
        const normalise = (tensorData) => {
            return {
                max: tensorData.max(),
                min: tensorData.min(),
                tensor: tensorData.sub(tensorData.min()).div(tensorData.max().sub(tensorData.min()))
            };
        }

        const denormalise = (normalisedTensor, min, max) => {
            return normalisedTensor.mul(max.sub(min)).add(min);
        }

        async function plot(pointsArray, featureName) {
            tfvis.render.scatterplot(
                { name: `${featureName} vs House price`, tab: 'Chart' },
                { values: [pointsArray], series: ["original"] },
                { xLabel: 'sqft_living', yLabel: 'price' }
            );
        }

        const run = async () => {
            const localCsvFilePath = './kc_house_data.csv';
            const csvDataset = tf.data.csv(
                localCsvFilePath,
                {
                    hasHeader: true,
                    // columnNames: ['id', 'date', 'price', 'bedrooms', 'bathrooms', 'sqft_living', 'sqft_lot', 'floors', 'waterfront', 'view', 'condition', 'grade', 'sqft_above', 'sqft_basement', 'yr_built', 'yr_renovated', 'zipcode', 'lat', 'long', 'sqft_living15', 'sqft_lot15'],
                    columnConfigs: {
                        sqft_living: {
                            required: true
                        },
                        price: {
                            isLabel: true
                        }
                    },
                    configuredColumnsOnly: true
                });
            // const sampleDataset = csvDataset.take(10);
            // await sampleDataset.forEachAsync(e => console.log(e));
            // const dataArray = await sampleDataset.toArray();
            // console.log(dataArray);

            const points = csvDataset.map(record => ({
                x: record.sqft_living,
                y: record.price,
            }));

            plot(await points.toArray(), "Square feet");

            const featureValues = await points.map(row => row.x).toArray();
            const featureTensor = tf.tensor2d(featureValues, [featureValues.length, 1]);
            const labelValues = await points.map(row => row.y).toArray();
            const labelTensor = tf.tensor2d(labelValues, [labelValues.length, 1]);

            featureTensor.print();
            labelTensor.print();

            normalisedFeature = normalise(featureTensor);
            normalisedLable = normalise(labelTensor);
            console.log(csvDataset.sqft_living);
        }

        run();

    </script>
</body>

</html>